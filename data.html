<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>ESSP IV: Data</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="left-sidebar is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header">

					<!-- Inner -->
						<div class="inner">
							<header>
								<h1><a href="index.html" id="logo">IV</a></h1>
							</header>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="index.html">Overview</a>
									<ul>
										<li><a href="index.html#purpose">Statement of Purpose</a></li>
										<li><a href="index.html#timeline">Timeline</a></li>
										<li><a href="index.html#feedback">Feedback Form</a></li>
									</ul>
								</li>
								<li><a href="data.html">Data</a>
									<ul>
										<li><a href="data.html#code">Example Code</a></li>
										<li><a href="data.html#spectra">Spectra</a></li>
										<li><a href="data.html#ccf">CCFs</a></li>
										<li><a href="data.html#timeseries">Time Series</a></li>
									</ul>
								</li>
								<li><a href="agreement.html">Agreements</a>
									<ul>
										<li><a href="agreement.html#instruments">Instrument Acknowledgements</a></li>
										<li><a href="agreement.html#collaboration">ESSP Collaboration Agreement</a></li>
									</ul>
								</li>
								<li><a href="submission.html">Submission Guidelines</a>
									<ul>
                                        <li><a href="submission.html#initial">Initial Data Products</a></li>
										<li><a href="submission.html#team">Team Information</a></li>
										<li><a href="submission.html#basics">Method Basics</a></li>
                                        <li><a href="submission.html#briefs">Method Briefs</a></li>
										<li><a href="submission.html#details">Method Details</a></li>
										<li><a href="submission.html#results">Results</a></li>
									</ul>
								</li>
							</ul>
						</nav>

				</div>

			<!-- Main -->
				<div class="wrapper style1">

					<div class="container">
						<div class="row gtr-200">
							<div class="col-4-side col-12-mobile-side" id="sidebar">
								<hr class="first" />
							<hr />
								<section>
									<header>
										<h3><a href="#code">Example Code</a></h3>
									</header>
								</section>
                            <hr />
                                <section>
                                    <header>
                                        <h3><a href="#spectra">Spectra</a></h3>
                                    </header>
                                </section>
							<hr />
								<section>
									<header>
										<h3><a href="#ccf">CCFs</a></h3>
									</header>
								</section>
							<hr />
								<section>
									<header>
										<h3><a href="#timeseries">Time Series</a></h3>
									</header>
								</section>
							<hr />
							</div>
							<div class="col-8 col-12-mobile imp-mobile" id="content">
								<article id="main">
									<section>
										<header>
											<h2>Data Descriptions</h2>
										</header>
										<!--<a class="image featured"><img src="images/pic06.jpg" alt="" /></a>-->
										<p>
											This page details the ESSP IV standardized data products, important things to note, and provides links to example code.
										</p>

										<p>
                                            We ask that all methods submit results using the provided standardized data products.  If you would also like to test your methods on custom generated data products, plwease submit those results <i>in addition to</i> results using the standardized data products.
										</p>

										<p>

											<b>The data can be accessed via the following <a href="https://uchicago.box.com/s/86nlwl2yiqxvs1159kgyfnqpjs424rdf" target="blank" style="color: #EAA422;">link</a>.</b>
										</p>
									</section>
                                <hr />
                                    <section id="code">
                                        <header>
                                            <h3>Example Code</h3>
                                        </header>
                                        <ol>
                                            <li id="example_spectra">
                                                ESSP IV standardized spectra
                                                <ul>
                                                    <li><a href="documents/code/essp4_spec.py" download><span class="icon solid fa-code" target="_blank"></span></a> Python Script</li>
                                                    <li><a href="documents/code/essp4_spec.ipynb" download><span class="icon solid fa-terminal"></span></a> Jupyter Notebook</li>
                                                </ul>
                                            </li>
                                            <li id="example_ccf">
                                                ESSP IV order-by-order and combined CCF
                                                <ul>
                                                    <li><a href="documents/code/essp4_ccfs.py" download><span class="icon solid fa-code" target="_blank"></span></a> Python Script</li>
                                                    <li><a href="documents/code/essp4_ccfs.ipynb" download><span class="icon solid fa-terminal"></span></a> Jupyter Notebook</li>
                                                </ul>
                                            </li>
                                            <li id="example_timeseries">
                                                Time series of RVs/indicators
                                                <ul>
                                                    <li><a href="documents/code/essp4_timeSeries.py" download><span class="icon solid fa-code" target="_blank"></span></a> Python Script</li>
                                                    <li><a href="documents/code/essp4_timeSeries.ipynb" download><span class="icon solid fa-terminal"></span></a> Jupyter Notebook</li>
                                                </ul>
                                            </li>
                                        </ol>
                                        <p>
                                            Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if there is any additional code you would find helpful or examples in additional coding languages.
                                        </p>
                                        
                                    </section>
								<hr />
									<section id="spectra">
										<header>
											<h3>Spectra</h3>
										</header>
										<p>
											Data from all four instruments have been rewritten to a standard FITS format.  The spectral data is stored in different HDUs, which are named by the below keywords.  All data have dimensions of [number of orders, number of pixels].
										</p>

                                        <p>
                                        <table class="bordered">
                                            <thead>
                                                <tr>
                                                    <th class="bordered" style='width:150px'>Keyword</th>
                                                    <th>Description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>WAVELENGTH</td>
                                                    <td>Barycentric corrected wavelengths in angstroms</td>
                                                </tr>
                                                <tr>
                                                    <td>FLUX</td>
                                                    <td>Intensity at the given wavelength; includes instrument blaze response</td>
                                                </tr>
                                                <tr>
                                                    <td>UNCERTAINTY</td>
                                                    <td>Standard deviation for each flux value as assigned by each instrumentâ€™s data reduction pipeline</td>
                                                </tr>
                                                <tr>
                                                    <td>CONTINUUM</td>
                                                    <td>Continuum model</td>
                                                </tr>
                                                <tr>
                                                    <td>BLAZE</td>
                                                    <td>Blaze model, which can be used to remove the general blaze shape from the FLUX array</td>
                                                </tr>
                                                <tr>
                                                    <td>COMMON_MASK</td>
                                                    <td>A binary mask that is True for wavelengths that are present for all instruments</td>
                                                </tr>
                                                <tr>
                                                    <td>TELLURIC_MASK</td>
                                                    <td>A binary mask that is True where telluric features have been masked and spectral values are replaced with NaNs</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        </p>

                                        <h4>Important to Note</h4>
                                        
                                        <ol>
                                            <li>Some orders will have only NaN values (<a href="#padded_orders">read more</a>)</li>
                                            <li>Redder orders will have NaNs sprinkled throughout due to telluric masking (<a href="#telluric_masking">read more</a>)</li>
                                            <li>A subset of headers have been included (<a href="#spec_headers">read more</a>); please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if any headers required by your method are missing</li>
                                            <li>Masking may be required of the low SNR EXPRES order edges (<a href="#expres_edges">read more</a>)</li>
                                            <li>Redder NEID orders (i.e. echelle orders greater than 69) are not included due to significant telluric contamination and low signal (<a href="#neid_red">read more</a>)</li>
                                        </ol>

                                        <h4 id="padded_orders">Relative Orders Standardized to Echelle Order</h4>

                                        <p>
                                            The data within each file have been re-organized such that the relative indexing of orders always maps to the same echelle order.  In other words, the first order in every standardized FITS file corresponds to echelle order 161.  Calling the Nth order of this standardized data will return an echelle order of a comparable wavelength regardless of the source instrument (e.g., H-alpha appears in the 69th entry of the standardized data for all instruments).
                                        </p>

                                        <p>
                                            Data has been padded as necessary with NaNs.  For instance, NEID orders start at echelle order 161 while EXPRES orders start at echelle order 160.  Therefore, the first entry for every EXPRES file contains only NaNs.  Of particular note is that the HARPS data does not contain echelle order 115 (relative order 47 in the standardized data format).
                                        </p>

                                        <p>
                                            The provided <a href="#example_spectra">example code</a> includes a simple function to generate a mask that will exclude orders that are all NaNs.
                                        </p>
                                        
                                        <h4 id="telluric_masking">Telluric Masking</h4>

                                        <p>
                                            In addition to the all NaN orders described above, there will also be NaNs throughout orders where telluric features have been masked out.  We choose to mask out tellurics rather than remove and re-inject these lines with a potentially flawed telluric model.  We believe introducing NaNs is preferable to potentially adding spurious features due to model inaccuracies, especially as such features could lead to systematics that are difficult to diagnose.
                                        </p>

                                        <p>
                                            The requested detailed questions for each method will ask how this masking affects the performance of your method.  <b>Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if the introduction of NaNs significantly hinders the implementation of your method. </b>
                                        </p>
                                        
                                        <h4 id="spec_headers">Standardized Headers</h4>

                                        <p>
                                            Header keywords have been standardized across instruments (largely following the recommendations of <a href="https://www.spiedigitallibrary.org/conference-proceedings-of-spie/13101/131011E/A-community-driven-modular-data-pipeline-architecture-to-push-EPRV/10.1117/12.3018595.full" target="blank">Burt et al. 2024</a>).  The included keywords and their counterparts in the original FITS files are listed in this <a href="documents/essp4_spec_headers.pdf" target="blank">table</a>.

                                        <p>
                                            <b>Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if required header information for your method is not included in the standardized files.</b>
                                        </p>
                                        
                                        <h4 id="expres_edges">EXPRES Order Edges</h4>

                                        <p>
                                            EXPRES order edges, especially in the blue, will exhibit NaNs and very low SNR values.
                                        </p>

                                        <p>
                                            The extracted EXPRES spectra encompass the full detector, resulting in 7920 pixels in each order.  In practice, however, the signal drops off sharply at the edge of each order with the blaze function.  Pixels with too little signal to be extracted are replaced with NaNs.
                                        </p>

                                        <p>
                                            Very low SNR extracted values will persist on the edges of EXPRES orders, especially in the blue.  This can result in noisy, even negative extracted values.  These noisy values are accompanied by corresponding large uncertainties, but we find that in practice it is easiest to implement an uncertainty cut on extracted values.  We recommend masking out all values with a large fractional uncertainty in addition to excluding the NaN values in each order.
                                        </p>
                                        
                                        <h4 id="neid_red">NEID Redder Orders</h4>

                                        <p>
                                            For the NEID data, we include only echelle orders 161-69, which spans approximately 3770 to 8968 A.  Spectra redder than echelle order 69 are not likely to be useful due to the significant telluric masking required in this region.  Over 50% of pixels in these orders are masked.  There are also few CCF lines for these orders (on the order of 5 per order).
                                        </p>
                                        
									</section>
								<hr />
									<section id="ccf">
										<header>
											<h3>CCFs</h3>
										</header>
										<p>
											Standardized spectra have been run through the same CCF pipeline using the same CCF mask and sampled on the same velocity grid.  The CCF from each order is reweighted before being combined into a global CCF; the specific weighting is different for each instrument.  The resultant CCF files contain the following HDUs.  
										</p>

                                        <p>
                                            We use N<sub>v</sub> to indicate the length of the velocity grid and N<sub>o</sub> to indicate the number of echelle orders.
                                            <table class="bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Keyword</th>
                                                        <th style='width:80px'>Shape</th>
                                                        <th>Description</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>V_GRID</td>
                                                        <td align="center">N<sub>v</sub></td>
                                                        <td>Velocity grid in km/s for all CCFs in file</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CCF</td>
                                                        <td align="center">N<sub>v</sub></td>
                                                        <td>Global CCF value (i.e. all orders combined)</td>
                                                    </tr>
                                                    <tr>
                                                        <td>E_CCF</td>
                                                        <td align="center">N<sub>v</sub></td>
                                                        <td>Global CCF errors</td>
                                                    </tr>
                                                    <tr>
                                                        <td>ECHELLE_ORDERS</td>
                                                        <td align="center">N<sub>o</sub></td>
                                                        <td>Corresponding echelle order for each order-by-order (obo) entry</td>
                                                    </tr>
                                                    <tr>
                                                        <td>OBO_CCF</td>
                                                        <td align="center">N<sub>o</sub> x N<sub>v</sub></td>
                                                        <td>Order-by-order CCFs</td>
                                                    </tr>
                                                    <tr>
                                                        <td>OBO_E_CCF</td>
                                                        <td align="center">N<sub>o</sub> x N<sub>v</sub></td>
                                                        <td>Order-by-order CCF Errors</td>
                                                    </tr>
                                                    <tr>
                                                        <td>OBO_CCF_RV</td>
                                                        <td align="center">N<sub>o</sub></td>
                                                        <td>Best-fit CCF RV (mean of a Gaussian fit) for each order in m/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>OBO_CCF_E_RV</td>
                                                        <td align="center">N<sub>o</sub></td>
                                                        <td>Standard deviation of the mean of the Gaussian fit to each order's CCF m/s</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </p>

                                        <h4>Important to Note</h4>
                                        
                                        <ol>
                                            <li>Some order specific CCFs will have only NaN values (<a href="#padded_orders">read more</a>)</li>
                                            <li>The standard velocity grid is oversampled for HARPS and HARPS-N (<a href="#velocity_sampling">read more</a>)</li>
                                            <li>Very few headers have been included; please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if any headers required by your method are missing.</li>
                                        </ol>
                                        
                                        <h4 id="velocity_sampling">HARPS/HARPS-N Velocity Sampling</h4>

                                        <p>
                                            The provided standardized CCFs all share the same velocity grid with a spacing of 400 m/s, which oversamples the HARPS/HARPS-N pixel sampling.  For the HARPS/HARPS-N pipeline, a spacing of 820 m/s is used.
                                        </p>

                                        <p>
                                            If your method does not require a uniform velocity grid across all instruments or treats each instrument separately, we recommend downsampling the velocity grid by half.  The provided <a href="#example_ccf">example code</a> contains a function that implements this.
                                        </p>

									</section>
                                <hr />
                                    <section id="timeseries">
                                        <header>
                                            <h3>Time Series</h3>
                                        </header>
                                        <p>
                                            A CSV file containing time series information (e.g. RVs, indicators, etc.) is given for each data set.  We recommend using pandas to interact with these files, though another option is given in the provided <a href="#example_timeseries">example code</a>.
                                        </p>

                                        <p>
                                            <table class="bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Column Name</th>
                                                        <th>Description</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Standard File Name</td>
                                                        <td>Name of associated standard spectrum file.</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Time [eMJD]</td>
                                                        <td>Photon weighted midpoint in eMJD (i.e. extra modified JD)</td>
                                                    </tr>
                                                    <tr>
                                                        <td>RV [m/s]</td>
                                                        <td>Radial velocity in m/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>RV Err. [m/s]</td>
                                                        <td>Radial velocity error in m/s (analytic, from CCF fit)</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Exp. Time [s]</td>
                                                        <td>Exposure time of observation in seconds</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Airmass</td>
                                                        <td>Airmass of observation</td>
                                                    </tr>
                                                    <tr>
                                                        <td>BERV [km/s]</td>
                                                        <td>Barycentric velocity of observation in km/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Instrument</td>
                                                        <td>Source instrument for observation</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CCF FWHM [km/s]</td>
                                                        <td>FWHM of Gaussian fit to global CCF in km/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CCF FWHM Err. [km/s]</td>
                                                        <td>Standard deviation of the FWHM of the Gaussian fit to the global CCF in km/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CCF Contrast</td>
                                                        <td>Amplitude of Gaussian fit to the global CCF</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CCF Contrast Err.</td>
                                                        <td>Standard deviation of the amplitude of the Gaussian fit to the global CCF</td>
                                                    </tr>
                                                    <tr>
                                                        <td>BIS [m/s]</td>
                                                        <td>CCF bisector skew as defined in <a href="https://ui.adsabs.harvard.edu/abs/2001A%26A...379..279Q/abstract" target="blank">Queloz et al. 2001</a> in km/s</td>
                                                    </tr>
                                                    <tr>
                                                        <td>H-alpha Emission</td>
                                                        <td>Minimum value in the H-alpha line with continuum normalized spectra</td>
                                                    </tr>
                                                    <tr>
                                                        <td>CaII Emission</td>
                                                        <td>Emission in core of Ca II HK lines</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            (The provided <a href="#example_timeseries">example code</a> includes a demonstration of how to rename the columns.)
                                        </p>

                                        <h4>Important to Note</h4>
                                        
                                        <ol>
                                            <li>Time stamps (throughout all data products) feature an additional offset from their original time stamps</li>
                                            <li>Some analytical errors for activity indicators are provided, but there is also the option to use empirical errors, described more below (<a href="#indicator_errors">read more</a>)</li>
                                            <li>We suggest that derived indicators from each instrument be treated independently (<a href="#indicator_offsets">read more</a>)</li>
                                            <li>Please <a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">reach out</a> if any indicators required by your method are missing.</li>
                                        </ol>
                                        
                                        <h4 id="indicator_errors">Empirical Errors</h4>

                                        <p>
                                            The derived analytical errors appear to underestimate the error for CCF FWHM/Contrast and are not given for BIS, H-alpha emission, and CaII emission.  To derive an empirical error, we found the spread in indicator values across the full month of provided data.  This should be an appropriate error estimate as the Sun was relatively inactive during these observations.
                                        </p>

                                        <p>
                                            We therefore suggest using the following empirical errors:
                                        
                                            <ul>
                                                <li>CCF FWHM [km/s]: 0.005</li>
                                                <li>CCF Contrast: 130</li>
                                                <li>BIS [m/s]: 0.95</li>
                                                <li>H-alpha Emission: 0.001</li>
                                                <li>CaII Emission: 0.003</li>
                                            </ul>
                                        </p>

                                        <h4 id="indicator_offsets">Indicator Offsets/Scaling</h4>

                                        <p>
                                            We suggest treating the indicators from each instrument independently.  It is obvious that at least an offset is needed between indicators from different instruments.  At this time, we are still working to establish whether a scaling will also be needed at the level of EPRV work.  For instance, CCF FWHM shows an obvious need for both an offset and scaling factor.
                                        </p>

                                        <p>
                                            We therefore opt to present the indicators directly as they are derived from the spectra/CCFs, but advise that different model parameters will likely be needed for each instrument.
                                        </p>
                                    </section>
								</article>
							</div>
						</div>
					</div>

				</div>

			<!-- Footer -->
				<div id="footer">
					<div class="container">
						<div class="row">

							<!-- Column 1 -->
                            <section class="col-4 col-12-mobile">
                                <section>
                                    <span class="icon alt fa-comments"></span>
                                    <h4>Feedback Form</h4>
                                    <span><a href="https://docs.google.com/forms/d/e/1FAIpQLSclzbYTv_394VuOWscJN49P2PijJJoBxLqXr6YGGZjbNMve_A/viewform?usp=sharing" target="blank">Link</a></span>
                                </section>
                            </section>

                        <!-- Column 2 -->
                            <section class="col-4 col-12-mobile">
                                <section>
                                    <span class="icon solid fa-users"></span>
                                    <h4>Collaboration Agreement</h4>
                                    <span><a href="agreement.html#collaboration">Link</a></span>
                                </section>
                            </section>

                        <!-- Column 3 -->
                            <section class="col-4 col-12-mobile">
                                <section>
                                    <span class="icon alt fa-bookmark"></span>
                                    <h4>Previous Reports</h4>
                                    <span>
                                        <a href="https://ui.adsabs.harvard.edu/abs/2023AJ....166..173Z/abstract" target="blank">ESSP III</a>: solar data across instruments<br>
                                        <a href="https://ui.adsabs.harvard.edu/abs/2022AJ....163..171Z/abstract" target="blank">ESSP II</a>: method comparison with EXPRES data
                                    </span>
                                </section>
                            </section>

						</div>
					</div>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>